var V=(K,C,f)=>new Promise((S,b)=>{var x=i=>{try{y(f.next(i))}catch(w){b(w)}},_=i=>{try{y(f.throw(i))}catch(w){b(w)}},y=i=>i.done?S(i.value):Promise.resolve(i.value).then(x,_);y((f=f.apply(K,C)).next())});import{_ as ue,u as de,r as o,c as _e,s as H,o as ve,d as h,e as u,f as l,w as a,l as fe,j as d,m as v,i as r,h as R,G as pe,t as M,H as ge,g as $,J as me,D as he,K as B,E as c,b as J,q as ye}from"./index-wIxDU7xz.js";const we={class:"memory-view"},ke={key:0,class:"empty-state"},Ce={key:1},be={class:"stats-section"},Se={class:"stat-content"},xe={class:"stat-number"},Te={class:"search-section"},De={key:0,class:"batch-actions"},ze={class:"selected-info"},Ve={class:"action-buttons"},Be={key:0,class:"edit-cell"},Ee={class:"edit-actions"},Re={key:1},Me={key:0,class:"file-path"},$e={key:1,class:"empty-value"},Ie={class:"pagination-container"},Ae={class:"pagination-actions"},Ke={__name:"MemoryView",setup(K){const C=de(),f=o(!1),S=o(!1),b=o(null),x=o(!1),_=o([]),y=o(""),i=o(1),w=o(20),N=o(0),P=o({total_count:0}),m=o(null),k=o(""),p=o([]),T=o(null);let I=null;const Q=_e(()=>_.value.length>0&&p.value.length===_.value.length),g=()=>V(null,null,function*(){f.value=!0;try{const t=yield B.getTranslations(i.value,w.value,y.value);t.success?(_.value=t.data.translations,N.value=t.data.total_count):c.error(t.message||"获取翻译记录失败");const e=yield B.getStats();e.success&&(P.value=e.stats)}catch(t){console.error("加载翻译记忆数据失败:",t),c.error("加载翻译记忆数据失败")}finally{f.value=!1}}),F=()=>{g()},L=()=>{I&&clearTimeout(I),I=setTimeout(()=>{i.value=1,g()},500)},O=t=>{i.value=t,D(),g()},W=t=>{w.value=t,i.value=1,D(),g()},X=t=>{m.value=t.id,k.value=t.target},j=()=>{m.value=null,k.value=""},U=()=>V(null,null,function*(){if(!k.value.trim()){c.warning("译文不能为空");return}try{S.value=!0;const t=yield B.updateTranslation(m.value,{target:k.value.trim()});if(t.success){c.success("更新成功");const e=_.value.findIndex(n=>n.id===m.value);e!==-1&&(_.value[e].target=k.value.trim()),j()}else c.error(t.message||"更新失败")}catch(t){console.error("更新翻译失败:",t),c.error("更新翻译失败")}finally{S.value=!1}}),Y=t=>V(null,null,function*(){try{yield J.confirm("确定要删除这条翻译记录吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),b.value=t.id;const e=yield B.deleteTranslation(t.id);e.success?(c.success("删除成功"),g()):c.error(e.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除翻译失败:",e),c.error("删除翻译失败"))}finally{b.value=null}}),Z=t=>{p.value=t},ee=()=>{ye(()=>{T.value&&_.value.forEach(t=>{m.value!==t.id&&T.value.toggleRowSelection(t,!0)})})},D=()=>{p.value=[],T.value&&T.value.clearSelection()},te=()=>V(null,null,function*(){if(p.value.length===0){c.warning("请先选择要删除的记录");return}try{yield J.confirm(`确定要删除选中的 ${p.value.length} 条翻译记录吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),x.value=!0;const t=p.value.map(n=>n.id),e=yield B.batchDeleteTranslations(t);e.success?(c.success(`成功删除 ${e.deleted_count} 条记录`),D(),g()):c.error(e.message||"批量删除失败")}catch(t){t!=="cancel"&&(console.error("批量删除翻译失败:",t),c.error("批量删除翻译失败"))}finally{x.value=!1}});return H(()=>C.isConfigSelected,t=>{t&&g()}),H(()=>C.isConfigSelected,t=>{t&&_.value.length===0&&g()}),ve(()=>{C.isConfigSelected&&g()}),(t,e)=>{const n=d("el-button"),le=d("el-empty"),ae=d("Document"),E=d("el-icon"),q=d("el-card"),se=d("Search"),G=d("el-input"),ne=d("Refresh"),oe=d("Delete"),z=d("el-table-column"),ie=d("el-table"),re=d("el-pagination"),ce=ge("loading");return u(),h("div",we,[l(q,{class:"header-card"},{header:a(()=>e[3]||(e[3]=[r("div",{class:"card-header"},[r("span",null,"🧠 翻译记忆库"),r("p",null,"查看和管理翻译历史记录")],-1)])),default:a(()=>[fe(C).isConfigSelected?(u(),h("div",Ce,[r("div",be,[l(q,{class:"stat-card"},{default:a(()=>[r("div",Se,[r("div",xe,M(P.value.total_count),1),e[5]||(e[5]=r("div",{class:"stat-label"},"翻译记录总数",-1))]),l(E,{class:"stat-icon"},{default:a(()=>[l(ae)]),_:1})]),_:1})]),r("div",Te,[l(G,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=s=>y.value=s),placeholder:"搜索原文、译文或文件路径...",style:{width:"400px"},clearable:"",onInput:L},{prefix:a(()=>[l(E,null,{default:a(()=>[l(se)]),_:1})]),_:1},8,["modelValue"]),l(n,{onClick:F,loading:f.value},{default:a(()=>[l(E,null,{default:a(()=>[l(ne)]),_:1}),e[6]||(e[6]=v(" 刷新 "))]),_:1,__:[6]},8,["loading"])]),p.value.length>0?(u(),h("div",De,[r("div",ze," 已选择 "+M(p.value.length)+" 条记录 ",1),r("div",Ve,[l(n,{type:"danger",onClick:te,loading:x.value},{default:a(()=>[l(E,null,{default:a(()=>[l(oe)]),_:1}),e[7]||(e[7]=v(" 批量删除 "))]),_:1,__:[7]},8,["loading"]),l(n,{onClick:D},{default:a(()=>e[8]||(e[8]=[v(" 取消选择 ")])),_:1,__:[8]})])])):R("",!0),pe((u(),$(ie,{ref_key:"tableRef",ref:T,data:_.value,stripe:"",style:{width:"100%"},onSelectionChange:Z},{default:a(()=>[l(z,{type:"selection",width:"55",selectable:s=>m.value!==s.id},null,8,["selectable"]),l(z,{prop:"source",label:"原文","min-width":"300","show-overflow-tooltip":""}),l(z,{prop:"target",label:"译文","min-width":"300","show-overflow-tooltip":""},{default:a(s=>[m.value===s.row.id?(u(),h("div",Be,[l(G,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=A=>k.value=A),type:"textarea",rows:2,onKeyup:me(he(U,["ctrl"]),["enter"])},null,8,["modelValue","onKeyup"]),r("div",Ee,[l(n,{size:"small",type:"primary",onClick:U,loading:S.value},{default:a(()=>e[9]||(e[9]=[v(" 确定 ")])),_:1,__:[9]},8,["loading"]),l(n,{size:"small",onClick:j},{default:a(()=>e[10]||(e[10]=[v(" 取消 ")])),_:1,__:[10]})])])):(u(),h("div",Re,M(s.row.target),1))]),_:1}),l(z,{prop:"file_path",label:"文件路径","min-width":"200","show-overflow-tooltip":""},{default:a(s=>[s.row.file_path?(u(),h("span",Me,M(s.row.file_path),1)):(u(),h("span",$e,"-"))]),_:1}),l(z,{label:"操作",width:"150",fixed:"right"},{default:a(s=>[m.value!==s.row.id?(u(),$(n,{key:0,size:"small",type:"primary",onClick:A=>X(s.row)},{default:a(()=>e[11]||(e[11]=[v(" 编辑 ")])),_:2,__:[11]},1032,["onClick"])):R("",!0),l(n,{size:"small",type:"danger",onClick:A=>Y(s.row),loading:b.value===s.row.id},{default:a(()=>e[12]||(e[12]=[v(" 删除 ")])),_:2,__:[12]},1032,["onClick","loading"])]),_:1})]),_:1},8,["data"])),[[ce,f.value]]),r("div",Ie,[r("div",Ae,[_.value.length>0?(u(),$(n,{key:0,size:"small",onClick:ee,disabled:Q.value},{default:a(()=>e[13]||(e[13]=[v(" 全选当前页 ")])),_:1,__:[13]},8,["disabled"])):R("",!0),p.value.length>0?(u(),$(n,{key:1,size:"small",onClick:D},{default:a(()=>e[14]||(e[14]=[v(" 取消选择 ")])),_:1,__:[14]})):R("",!0)]),l(re,{"current-page":i.value,"page-size":w.value,total:N.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:O,onSizeChange:W},null,8,["current-page","page-size","total"])])])):(u(),h("div",ke,[l(le,{description:"请先选择配置"},{default:a(()=>[l(n,{type:"primary",onClick:e[0]||(e[0]=s=>t.$router.push("/"))},{default:a(()=>e[4]||(e[4]=[v(" 去配置管理 ")])),_:1,__:[4]})]),_:1})]))]),_:1})])}}},je=ue(Ke,[["__scopeId","data-v-4905eccd"]]);export{je as default};
