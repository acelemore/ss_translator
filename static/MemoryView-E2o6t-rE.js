var B=(N,b,f)=>new Promise((S,x)=>{var m=d=>{try{u(f.next(d))}catch(k){x(k)}},n=d=>{try{u(f.throw(d))}catch(k){x(k)}},u=d=>d.done?S(d.value):Promise.resolve(d.value).then(m,n);u((f=f.apply(N,b)).next())});import{_ as ne,u as ie,r as c,c as U,s as j,o as re,d as v,e as i,f as l,w as a,l as de,j as r,m as h,i as o,h as $,G as ce,t as C,H as ue,g as A,J as R,E as y,b as q,q as _e}from"./index-B0OZ2IFU.js";const pe={class:"memory-view"},ve={key:0,class:"empty-state"},fe={key:1},me={class:"stats-section"},ge={class:"stat-content"},he={class:"stat-number"},ye={class:"search-section"},we={class:"search-header"},be={class:"search-fields"},xe={class:"search-field"},ke={class:"search-field"},Ce={class:"search-field"},Se={class:"search-field"},Ve={class:"search-actions"},Te={key:0,class:"batch-actions"},De={class:"selected-info"},ze={class:"action-buttons"},Be={key:0,class:"file-path"},Re={key:1,class:"empty-value"},Ie={key:0,class:"approved-text"},Ee={key:1,class:"empty-value"},Me={key:0,class:"context-text"},$e={key:1,class:"empty-value"},Ae={class:"pagination-container"},Ne={class:"pagination-actions"},Pe={__name:"MemoryView",setup(N){const b=ie(),f=c(!1),S=c(null),x=c(!1),m=c([]),n=c({file_name:"",original_text:"",approved_text:"",context:""}),u=c(1),d=c(20),k=c(0),P=c({total_count:0}),g=c([]),V=c(null);let I=null;const G=U(()=>m.value.length>0&&g.value.length===m.value.length),H=U(()=>Object.values(n.value).some(t=>t.trim())),_=()=>B(null,null,function*(){f.value=!0;try{const t=yield R.getTranslations(u.value,d.value,n.value);t.success?(m.value=t.data.translations,k.value=t.data.total_count):y.error(t.message||"获取翻译记录失败");const e=yield R.getStats();e.success&&(P.value=e.stats)}catch(t){console.error("加载翻译记忆数据失败:",t),y.error("加载翻译记忆数据失败")}finally{f.value=!1}}),J=()=>{_()},O=()=>{n.value={file_name:"",original_text:"",approved_text:"",context:""},u.value=1,_()},D=()=>{I&&clearTimeout(I),I=setTimeout(()=>{u.value=1,_()},500)},F=t=>{u.value=t,T(),_()},K=t=>{d.value=t,u.value=1,T(),_()},L=t=>B(null,null,function*(){try{yield q.confirm("确定要删除这条翻译记录吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),S.value=t.id;const e=yield R.deleteTranslation(t.id);e.success?(y.success("删除成功"),_()):y.error(e.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除翻译失败:",e),y.error("删除翻译失败"))}finally{S.value=null}}),Q=t=>{g.value=t},W=()=>{_e(()=>{V.value&&m.value.forEach(t=>{V.value.toggleRowSelection(t,!0)})})},T=()=>{g.value=[],V.value&&V.value.clearSelection()},X=()=>B(null,null,function*(){if(g.value.length===0){y.warning("请先选择要删除的记录");return}try{yield q.confirm(`确定要删除选中的 ${g.value.length} 条翻译记录吗？`,"批量删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),x.value=!0;const t=g.value.map(p=>p.id),e=yield R.batchDeleteTranslations(t);e.success?(y.success(`成功删除 ${e.deleted_count} 条记录`),T(),_()):y.error(e.message||"批量删除失败")}catch(t){t!=="cancel"&&(console.error("批量删除翻译失败:",t),y.error("批量删除翻译失败"))}finally{x.value=!1}});return j(()=>b.isConfigSelected,t=>{t&&_()}),j(()=>b.isConfigSelected,t=>{t&&m.value.length===0&&_()}),re(()=>{b.isConfigSelected&&_()}),(t,e)=>{const p=r("el-button"),Y=r("el-empty"),Z=r("Document"),E=r("el-icon"),M=r("el-card"),z=r("el-input"),ee=r("Refresh"),te=r("Delete"),w=r("el-table-column"),le=r("el-tag"),ae=r("el-table"),oe=r("el-pagination"),se=ue("loading");return i(),v("div",pe,[l(M,{class:"header-card"},{header:a(()=>e[5]||(e[5]=[o("div",{class:"card-header"},[o("span",null,"🧠 翻译记忆库"),o("p",null,"查看和管理翻译历史记录")],-1)])),default:a(()=>[de(b).isConfigSelected?(i(),v("div",fe,[o("div",me,[l(M,{class:"stat-card"},{default:a(()=>[o("div",ge,[o("div",he,C(P.value.total_count),1),e[7]||(e[7]=o("div",{class:"stat-label"},"翻译记录总数",-1))]),l(E,{class:"stat-icon"},{default:a(()=>[l(Z)]),_:1})]),_:1})]),o("div",ye,[l(M,{class:"search-card"},{header:a(()=>[o("div",we,[e[9]||(e[9]=o("span",null,"🔍 搜索条件",-1)),l(p,{type:"text",onClick:O,disabled:!H.value},{default:a(()=>e[8]||(e[8]=[h(" 清空条件 ")])),_:1,__:[8]},8,["disabled"])])]),default:a(()=>[o("div",be,[o("div",xe,[e[10]||(e[10]=o("label",null,"文件名:",-1)),l(z,{modelValue:n.value.file_name,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.file_name=s),placeholder:"搜索文件名...",clearable:"",onInput:D},null,8,["modelValue"])]),o("div",ke,[e[11]||(e[11]=o("label",null,"原文:",-1)),l(z,{modelValue:n.value.original_text,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.original_text=s),placeholder:"搜索原文...",clearable:"",onInput:D},null,8,["modelValue"])]),o("div",Ce,[e[12]||(e[12]=o("label",null,"审核文本:",-1)),l(z,{modelValue:n.value.approved_text,"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.approved_text=s),placeholder:"搜索审核文本...",clearable:"",onInput:D},null,8,["modelValue"])]),o("div",Se,[e[13]||(e[13]=o("label",null,"上下文:",-1)),l(z,{modelValue:n.value.context,"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.context=s),placeholder:"搜索上下文...",clearable:"",onInput:D},null,8,["modelValue"])])]),o("div",Ve,[l(p,{onClick:J,loading:f.value},{default:a(()=>[l(E,null,{default:a(()=>[l(ee)]),_:1}),e[14]||(e[14]=h(" 刷新 "))]),_:1,__:[14]},8,["loading"])])]),_:1})]),g.value.length>0?(i(),v("div",Te,[o("div",De," 已选择 "+C(g.value.length)+" 条记录 ",1),o("div",ze,[l(p,{type:"danger",onClick:X,loading:x.value},{default:a(()=>[l(E,null,{default:a(()=>[l(te)]),_:1}),e[15]||(e[15]=h(" 批量删除 "))]),_:1,__:[15]},8,["loading"]),l(p,{onClick:T},{default:a(()=>e[16]||(e[16]=[h(" 取消选择 ")])),_:1,__:[16]})])])):$("",!0),ce((i(),A(ae,{ref_key:"tableRef",ref:V,data:m.value,stripe:"",style:{width:"100%"},onSelectionChange:Q},{default:a(()=>[l(w,{type:"selection",width:"55"}),l(w,{prop:"file_name",label:"文件名","min-width":"200","show-overflow-tooltip":""},{default:a(s=>[s.row.file_name?(i(),v("span",Be,C(s.row.file_name),1)):(i(),v("span",Re,"-"))]),_:1}),l(w,{prop:"original_text",label:"原文","min-width":"300","show-overflow-tooltip":""}),l(w,{label:"是否已审核",width:"120",align:"center"},{default:a(s=>[l(le,{type:s.row.approved?"success":"info",size:"small"},{default:a(()=>[h(C(s.row.approved?"已审核":"未审核"),1)]),_:2},1032,["type"])]),_:1}),l(w,{prop:"approved_text",label:"审核后文本","min-width":"300","show-overflow-tooltip":""},{default:a(s=>[s.row.approved_text?(i(),v("span",Ie,C(s.row.approved_text),1)):(i(),v("span",Ee,"-"))]),_:1}),l(w,{prop:"context",label:"上下文","min-width":"200","show-overflow-tooltip":""},{default:a(s=>[s.row.context?(i(),v("span",Me,C(s.row.context),1)):(i(),v("span",$e,"-"))]),_:1}),l(w,{label:"操作",width:"100",fixed:"right"},{default:a(s=>[l(p,{size:"small",type:"danger",onClick:Ue=>L(s.row),loading:S.value===s.row.id},{default:a(()=>e[17]||(e[17]=[h(" 删除 ")])),_:2,__:[17]},1032,["onClick","loading"])]),_:1})]),_:1},8,["data"])),[[se,f.value]]),o("div",Ae,[o("div",Ne,[m.value.length>0?(i(),A(p,{key:0,size:"small",onClick:W,disabled:G.value},{default:a(()=>e[18]||(e[18]=[h(" 全选当前页 ")])),_:1,__:[18]},8,["disabled"])):$("",!0),g.value.length>0?(i(),A(p,{key:1,size:"small",onClick:T},{default:a(()=>e[19]||(e[19]=[h(" 取消选择 ")])),_:1,__:[19]})):$("",!0)]),l(oe,{"current-page":u.value,"page-size":d.value,total:k.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:F,onSizeChange:K},null,8,["current-page","page-size","total"])])])):(i(),v("div",ve,[l(Y,{description:"请先选择配置"},{default:a(()=>[l(p,{type:"primary",onClick:e[0]||(e[0]=s=>t.$router.push("/"))},{default:a(()=>e[6]||(e[6]=[h(" 去配置管理 ")])),_:1,__:[6]})]),_:1})]))]),_:1})])}}},Ge=ne(Pe,[["__scopeId","data-v-8e5d42e6"]]);export{Ge as default};
