var v=(V,t,f)=>new Promise((x,i)=>{var a=_=>{try{g(f.next(_))}catch(S){i(S)}},w=_=>{try{g(f.throw(_))}catch(S){i(S)}},g=_=>_.done?x(_.value):Promise.resolve(_.value).then(a,w);g((f=f.apply(V,t)).next())});import{_ as Q,u as R,r as C,c as W,s as X,o as Y,v as Z,d as T,e as d,f as r,g as A,h as z,w as l,l as c,j as m,i as o,m as y,x as ee,t as k,y as se,F as te,k as ae,E as n,z as ne,p as b,A as re,b as F}from"./index-B0OZ2IFU.js";const le={class:"files-view"},oe={class:"card-header"},ie={class:"header-actions"},ue={key:0,class:"status-bar"},ce={key:1,class:"status-bar"},de={class:"files-header"},fe={key:0,class:"empty-state"},ge={key:1,class:"files-list"},_e={class:"file-content"},pe={class:"file-info"},ve={class:"file-header"},ye={class:"file-path"},me={class:"file-description"},we={class:"file-details"},he={class:"progress-text"},Te={class:"file-progress"},ke={class:"file-actions"},Se={__name:"FilesView",setup(V){const t=R(),f=C([]),x=C(!1),i=C(!1),a=C(!1),w=C(!1);let g=null;const _=W(()=>{const e=t.translationStatus;return e.running?`正在翻译: ${e.current_file} (进度: ${e.progress}%)`:e.status==="interrupted"||a.value?"正在停止翻译，请稍候...":"翻译服务就绪"}),S=()=>{const e=t.translationStatus;return e.running?"info":e.status==="interrupted"||a.value?"warning":"success"},p=()=>v(null,null,function*(){if(!t.isConfigSelected){n.warning("请先选择配置");return}try{x.value=!0;const e=yield ne.getFiles();e.error?n.error(e.error):f.value=e}catch(e){n.error("加载文件列表失败")}finally{x.value=!1}}),$=e=>v(null,null,function*(){if(!i.value)try{i.value=!0;const s=yield b.startTranslation(e);s.success?(n.success(s.message),yield t.updateTranslationStatus(),yield p(),B()):n.error(s.message)}catch(s){console.error("启动翻译失败:",s),n.error("启动翻译失败")}finally{i.value=!1}}),U=()=>v(null,null,function*(){if(!i.value)try{i.value=!0;const e=yield b.startTranslation(null);e.success?(n.success("开始翻译所有文件"),yield t.updateTranslationStatus(),yield p(),B()):n.error(e.message)}catch(e){console.error("启动翻译失败:",e),n.error("启动翻译失败")}finally{i.value=!1}}),L=()=>v(null,null,function*(){if(!a.value)try{yield F.confirm("确定要停止当前的翻译任务吗？停止后当前正在翻译的进度将被保存。","确认停止翻译",{type:"warning",confirmButtonText:"确定停止",cancelButtonText:"取消"}),a.value=!0;const e=yield b.stopTranslation();e.success?(n.success(e.message),yield t.updateTranslationStatus(),B()):(n.error(e.message),a.value=!1)}catch(e){if(e==="cancel")return;console.error("停止翻译失败:",e),n.error("停止翻译失败"),a.value=!1}}),j=e=>v(null,null,function*(){if(t.isTranslating||a.value){n.warning("翻译进行中或正在停止时无法重置进度");return}try{yield F.confirm("重置进度会删除已翻译的临时文件, 是否确认?","确认重置",{type:"warning",confirmButtonText:"确定重置",cancelButtonText:"取消"});const s=yield b.resetProgress(e);s.success?(n.success(s.message),yield p()):n.error(s.message)}catch(s){s!=="cancel"&&n.error("重置进度失败")}}),D=()=>v(null,null,function*(){if(t.isTranslating||a.value){n.warning("翻译进行中或正在停止时无法重置进度");return}if(!w.value)try{yield F.confirm("确定要重置所有文件的翻译进度吗？这将删除所有已翻译的临时文件，此操作不可撤销。","确认重置所有文件",{type:"warning",confirmButtonText:"确定重置所有",cancelButtonText:"取消",dangerouslyUseHTMLString:!0,message:`<div>
          <p><strong>警告：此操作将：</strong></p>
          <ul style="text-align: left; margin: 10px 0;">
            <li>清空所有文件的翻译进度</li>
            <li>删除所有已翻译的临时文件</li>
            <li>无法撤销此操作</li>
          </ul>
          <p>请确认您真的要重置所有文件的进度。</p>
        </div>`}),w.value=!0;const e=yield b.resetProgress(null);e.success?(n.success("所有文件进度已重置"),yield p()):n.error(e.message)}catch(e){e!=="cancel"&&n.error("重置所有文件进度失败")}finally{w.value=!1}}),H=e=>e.total_lines===0?0:Math.round(e.progress/e.total_lines*100),q=e=>{switch(e){case"已完成":return"success";case"翻译中":return"warning";case"无可翻译内容":return"success";case"未开始":return"info";case"正在停止":return"warning";case"已中断":return"info";default:return"info"}},B=()=>{g||(g=setInterval(()=>v(null,null,function*(){yield t.updateTranslationStatus(),yield p(),t.isTranslating||(I(),a.value=!1)}),3e3))},I=()=>{g&&(clearInterval(g),g=null),a.value=!1};return X(()=>t.isConfigSelected,e=>{e&&f.value.length===0&&p()}),Y(()=>v(null,null,function*(){t.isConfigSelected&&(yield p()),yield t.updateTranslationStatus(),t.isTranslating&&(B(),t.translationStatus.status==="interrupted"&&(a.value=!0))})),Z(()=>{I(),a.value=!1}),(e,s)=>{const h=m("el-button"),M=m("el-icon"),E=m("el-alert"),P=m("el-card"),G=m("el-empty"),N=m("el-tag"),J=m("el-progress"),K=m("el-button-group");return d(),T("div",le,[r(P,{class:"header-card"},{header:l(()=>[o("div",oe,[s[2]||(s[2]=o("span",null,"📁 文件列表",-1)),o("div",ie,[r(h,{type:"primary",onClick:U,disabled:!c(t).isConfigSelected||c(t).isTranslating||i.value,loading:i.value},{default:l(()=>s[0]||(s[0]=[y(" 开始翻译所有文件 ")])),_:1,__:[0]},8,["disabled","loading"]),c(t).isTranslating?(d(),A(h,{key:0,type:"danger",onClick:L,disabled:!c(t).isTranslating||a.value,loading:a.value},{default:l(()=>[a.value?z("",!0):(d(),A(M,{key:0},{default:l(()=>[r(c(ee))]),_:1})),y(" "+k(a.value?"停止中...":"停止翻译"),1)]),_:1},8,["disabled","loading"])):z("",!0),r(h,{onClick:p},{default:l(()=>[r(M,null,{default:l(()=>[r(c(se))]),_:1}),s[1]||(s[1]=y(" 刷新 "))]),_:1,__:[1]})])])]),default:l(()=>[c(t).currentConfig?(d(),T("div",ue,[r(E,{title:_.value,type:S(),closable:!1,"show-icon":""},null,8,["title","type"])])):(d(),T("div",ce,[r(E,{title:"请先选择配置",type:"warning",closable:!1,"show-icon":""})]))]),_:1}),c(t).isConfigSelected?(d(),A(P,{key:0},{header:l(()=>[o("div",de,[s[4]||(s[4]=o("span",null,"文件列表",-1)),r(h,{type:"danger",size:"small",onClick:D,disabled:c(t).isTranslating||a.value||w.value,loading:w.value},{default:l(()=>s[3]||(s[3]=[y(" 重置所有文件 ")])),_:1,__:[3]},8,["disabled","loading"])])]),default:l(()=>[f.value.length===0?(d(),T("div",fe,[r(G,{description:"暂无文件数据"},{default:l(()=>[r(h,{type:"primary",onClick:p},{default:l(()=>s[5]||(s[5]=[y("刷新文件列表")])),_:1,__:[5]})]),_:1})])):(d(),T("div",ge,[(d(!0),T(te,null,ae(f.value,u=>(d(),T("div",{key:u.path,class:"file-item"},[r(P,{shadow:"hover"},{default:l(()=>[o("div",_e,[o("div",pe,[o("div",ve,[o("h4",ye,k(u.path),1),r(N,{type:q(u.status),class:re({"no-content-tag":u.status==="无可翻译内容"})},{default:l(()=>[y(k(u.status),1)]),_:2},1032,["type","class"])]),o("p",me,k(u.description),1),o("div",we,[r(N,{size:"small"},{default:l(()=>[y(k(u.type.toUpperCase()),1)]),_:2},1024),o("span",he,k(u.progress)+"/"+k(u.total_lines),1)])]),o("div",Te,[r(J,{percentage:H(u),status:u.completed?"success":void 0,"stroke-width":8},null,8,["percentage","status"])]),o("div",ke,[r(K,null,{default:l(()=>[r(h,{size:"small",onClick:O=>$(u.path),disabled:c(t).isTranslating||i.value,loading:i.value},{default:l(()=>s[6]||(s[6]=[y(" 开始翻译 ")])),_:2,__:[6]},1032,["onClick","disabled","loading"]),r(h,{size:"small",type:"warning",onClick:O=>j(u.path),disabled:c(t).isTranslating||a.value},{default:l(()=>s[7]||(s[7]=[y(" 重置进度 ")])),_:2,__:[7]},1032,["onClick","disabled"])]),_:2},1024)])])]),_:2},1024)]))),128))]))]),_:1})):z("",!0)])}}},xe=Q(Se,[["__scopeId","data-v-ceac4868"]]);export{xe as default};
